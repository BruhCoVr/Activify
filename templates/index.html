<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Activify</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!--top navigation bar-->
    <div class="top-bar">
      <div class="title">Activify</div>
      <div class="hamburger" id="hamburger">&#9776;</div>
      <div class="menu" id="menu">
        <a href="#" id="addActivity">Add Activity</a>
        <a href="#item2">Item 2</a>
      </div>
    </div>

    <!--The Activity card that comes up when "Add Activity" is selected 
    from the hamburger drop down menu-->
    <div class="container" id="cardContainer">
      <!--inputs for hour, minutes, and seconds for the timer-->
      <div class="countdown-inputs">
        <div class="mb-3">
          <label for="hoursInput">Hours:</label>
          <input
            type="number"
            class="form-control hoursInput"
            min="0"
            style="width: 100px; display: inline-block"
          />

          <label for="minutesInput">Minutes:</label>
          <input
            type="number"
            class="form-control minutesInput"
            min="0"
            max="59"
            style="width: 100px; display: inline-block"
          />

          <label for="secondsInput">Seconds:</label>
          <input
            type="number"
            class="form-control secondsInput"
            min="0"
            max="59"
            style="width: 100px; display: inline-block"
          />
        </div>
        <!--button to start the countdown after time has been selected-->
        <button
          class="btn btn-primary startCountdownBtn"
          onclick="navigateToPage()"
        >
          Start Countdown
        </button>
        <!--text will change to numbers doing a count down-->
        <p class="mt-3 demo">Countdown Display</p>
      </div>
    </div>

    <!--alarm sound for when the count down finishes-->
    <audio
      id="alertSound"
      src="{{ url_for('static', filename='end-sound.mp3') }}"
      preload="auto"
    ></audio>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
    
    //toggles the visibility of the menu when the hamburger icon is clicked,
      document
        .getElementById("hamburger")
        .addEventListener("click", function () {
          const menu = document.getElementById("menu");
          menu.style.display = menu.style.display === "flex" ? "none" : "flex";
        });

     
      const cardContainer = document.getElementById("cardContainer"); //refers to cardContainer
      const addActivityBtn = document.getElementById("addActivity"); //refers to the button to initiate the addition of new activities to the cardContainer.

      addActivityBtn.addEventListener("click", function () {
        const activityName = prompt("Enter Activity Name"); //takes user's input for activity name 

        if (activityName) { // check if the user entered an activity name
          const newCard = document.createElement("div");
          newCard.classList.add("card", "mb-3");
          newCard.innerHTML = ` // set the inner HTML of the new card
            <button class="resize-btn">
                <i class="fas fa-plus"></i>
            </button>
            <p>${activityName}</p> // display the activity name entered by the user

            <div class="countdown-inputs"> //make a section for countdown inputs inside the card
                <div class="mb-3">
                    <label for="hoursInput">Hours:</label>
                    <input type="number" class="form-control hoursInput" min="0" style="width: 100px; display: inline-block;">

                    <label for="minutesInput">Minutes:</label>
                    <input type="number" class="form-control minutesInput" min="0" max="59" style="width: 100px; display: inline-block;">

                    <label for="secondsInput">Seconds:</label>
                    <input type="number" class="form-control secondsInput" min="0" max="59" style="width: 100px; display: inline-block;">
                </div>
                <button class="btn btn-primary startCountdownBtn">Start</button>
                <p class="mt-3 demo">Countdown Display</p>

                <!-- Embed Spotify playlist within the card under the timer-->
                <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/42VEJ82fOlDEFW6nMyoFtR?utm_source=generator&theme=0" width="100%" height="352" frameBorder="0" allowfullscreen=""
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
            </div>
          `;
          cardContainer.appendChild(newCard); // append the new card to the card container, where it will keep adding to the screen for every action

          //resize button within the new card
          newCard
            .querySelector(".resize-btn")
            .addEventListener("click", function () {
              newCard.classList.toggle("enlarged");
            });

          //listen to the countdown button within the new card
          newCard
            .querySelector(".startCountdownBtn")
            .addEventListener("click", function () {
              toggleCountdown(newCard);
            });
        }
      });

      let countdownTimer;
      let totalSeconds = 0; 
      let isPaused = true; 

      function toggleCountdown(card) {
        //related to the countdown within the specified card
        const demoDisplay = card.querySelector(".demo");
        const hoursInput = card.querySelector(".hoursInput");
        const minutesInput = card.querySelector(".minutesInput");
        const secondsInput = card.querySelector(".secondsInput");
        const startButton = card.querySelector(".startCountdownBtn");

        //check if countdown is paused
        if (isPaused) {
          //starting countdown for the first time
          if (totalSeconds === 0) {
            //get the input values, default to 0 if not a valid number
            const hours = parseInt(hoursInput.value) || 0;
            const minutes = parseInt(minutesInput.value) || 0;
            const seconds = parseInt(secondsInput.value) || 0;

            //calculate total seconds from adding input
            totalSeconds = hours * 3600 + minutes * 60 + seconds;
          }

          //change button text to "stop" when countdown is taking place
          startButton.innerText = "Stop"; 
          countdownTimer = setInterval(function () {
            //check if countdown has reached 0
            if (totalSeconds <= 0) {
              clearInterval(countdownTimer); //stop countdown
              demoDisplay.innerHTML = "TIME'S UP!"; //update display message
              playAlertSound(); //play alarm
              totalSeconds = 0; //reset total seconds
              startButton.innerText = "Start"; //reset button text to "start"
              return;
            }

            //calculate hours, minutes, and seconds from total seconds
            const hrs = Math.floor(totalSeconds / 3600);
            const mins = Math.floor((totalSeconds % 3600) / 60);
            const secs = totalSeconds % 60;

            //update display with remaining time
            demoDisplay.innerHTML = `${hrs}h ${mins}m ${secs}s `;
            totalSeconds--; 
          }, 1000); //update every second
        } else {
          clearInterval(countdownTimer); //stop timer if it's running
          startButton.innerText = "Start"; //change button text back to "Start"
        }

        isPaused = !isPaused; //toggle pause state
      }

      function playAlertSound() {
        //get audio element
        const alertSound = document.getElementById("alertSound");
        //play the alarm sound
        alertSound.play();

        //stop alarm after 5 seconds
        setTimeout(() => {
          alertSound.pause(); 
          alertSound.currentTime = 0; 
        }, 5000); 
      }
    </script>
  </body>
</html>
