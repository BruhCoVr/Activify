<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Activify</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="top-bar">
      <div class="title">Activify</div>
      <div class="hamburger" id="hamburger">
        &#9776;
      </div>
      <div class="menu" id="menu">
        <a href="#" id="addActivity">Add Activity</a>
        <a href="#item2">Item 2</a>
      </div>
    </div>

    <div class="container" id="cardContainer">
      <div class="countdown-inputs">
        <div class="mb-3">
          <label for="hoursInput">Hours:</label>
          <input
            type="number"
            class="form-control hoursInput"
            min="0"
            style="width: 100px; display: inline-block"
          />

          <label for="minutesInput">Minutes:</label>
          <input
            type="number"
            class="form-control minutesInput"
            min="0"
            max="59"
            style="width: 100px; display: inline-block"
          />

          <label for="secondsInput">Seconds:</label>
          <input
            type="number"
            class="form-control secondsInput"
            min="0"
            max="59"
            style="width: 100px; display: inline-block"
          />
        </div>
        <button class="btn btn-primary startCountdownBtn">Start Countdown</button>
        <p class="mt-3 demo">Countdown Display</p>
      </div>
    </div>

    <audio
      id="alertSound"
      src="{{ url_for('static', filename='end-sound.mp3') }}"
      preload="auto"
    ></audio>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
      // Hamburger menu toggle
      document
        .getElementById("hamburger")
        .addEventListener("click", function () {
          const menu = document.getElementById("menu");
          menu.style.display = menu.style.display === "flex" ? "none" : "flex";
        });

      // Add Activity Functionality
      const cardContainer = document.getElementById("cardContainer");
      const addActivityBtn = document.getElementById("addActivity");

      addActivityBtn.addEventListener("click", function () {
        const activityName = prompt("Enter Activity Name");

        if (activityName) {
          const newCard = document.createElement("div");
          newCard.classList.add("card", "mb-3");
          newCard.innerHTML = `
            <button class="resize-btn">
                <i class="fas fa-plus"></i>
            </button>
            <p>${activityName}</p>

            <div class="countdown-inputs">
                <div class="mb-3">
                    <label for="hoursInput">Hours:</label>
                    <input type="number" class="form-control hoursInput" min="0" style="width: 100px; display: inline-block;">

                    <label for="minutesInput">Minutes:</label>
                    <input type="number" class="form-control minutesInput" min="0" max="59" style="width: 100px; display: inline-block;">

                    <label for="secondsInput">Seconds:</label>
                    <input type="number" class="form-control secondsInput" min="0" max="59" style="width: 100px; display: inline-block;">
                </div>
                <button class="btn btn-primary startCountdownBtn">Start</button>
                <p class="mt-3 demo">Countdown Display</p>
            </div>
          `;
          cardContainer.appendChild(newCard);

          // Attach event listener for the resize button
          newCard.querySelector(".resize-btn").addEventListener("click", function () {
            newCard.classList.toggle("enlarged");
          });

          // Attach event listener for the countdown button
          newCard.querySelector(".startCountdownBtn").addEventListener("click", function () {
            toggleCountdown(newCard);
          });
        }
      });

      let countdownTimer;
      let totalSeconds = 0; // Store total seconds for the countdown
      let isPaused = true; // Start in a paused state

      function toggleCountdown(card) {
        const demoDisplay = card.querySelector(".demo");
        const hoursInput = card.querySelector(".hoursInput");
        const minutesInput = card.querySelector(".minutesInput");
        const secondsInput = card.querySelector(".secondsInput");
        const startButton = card.querySelector(".startCountdownBtn");

        // If not paused, start the countdown
        if (isPaused) {
          // Get input values if starting for the first time
          if (totalSeconds === 0) {
            const hours = parseInt(hoursInput.value) || 0;
            const minutes = parseInt(minutesInput.value) || 0;
            const seconds = parseInt(secondsInput.value) || 0;

            // Calculate total seconds
            totalSeconds = hours * 3600 + minutes * 60 + seconds;
          }

          startButton.innerText = "Stop"; // Change button text to "Stop"
          countdownTimer = setInterval(function () {
            if (totalSeconds <= 0) {
              clearInterval(countdownTimer);
              demoDisplay.innerHTML = "TIME'S UP!";
              playAlertSound();
              totalSeconds = 0; // Reset total seconds
              startButton.innerText = "Start"; // Reset button text
              return;
            }

            const hrs = Math.floor(totalSeconds / 3600);
            const mins = Math.floor((totalSeconds % 3600) / 60);
            const secs = totalSeconds % 60;

            demoDisplay.innerHTML = `${hrs}h ${mins}m ${secs}s `;
            totalSeconds--; // Decrement the total seconds
          }, 1000);
        } else {
          clearInterval(countdownTimer); // Stop the countdown
          startButton.innerText = "Start"; // Change button text to "Start"
        }

        isPaused = !isPaused; // Toggle the pause state
      }

      function playAlertSound() {
        const alertSound = document.getElementById("alertSound");
        alertSound.play();

        // Stop the sound after 5 seconds
        setTimeout(() => {
          alertSound.pause(); // Pause the audio
          alertSound.currentTime = 0; // Reset the audio to the start
        }, 5000); // 5000 milliseconds = 5 seconds
      }
    </script>
  </body>
</html>